(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{5855:function(e,t,a){Promise.resolve().then(a.bind(a,5608))},5608:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var n=a(7437),l=a(2265);let s="http://10.1.1.21:3700";async function o(e){let t=await fetch("".concat(s).concat(e),{cache:"no-store"});if(!t.ok)throw Error("GET ".concat(e," failed: ").concat(t.status));return t.json()}async function i(e,t){let a=await fetch("".concat(s).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),cache:"no-store"});if(!a.ok)throw Error("POST ".concat(e," failed: ").concat(a.status));return a.json()}function r(e){return i("/selections/".concat(e.sessionToken,"/").concat(e.imageId),{state:e.state,print:e.print})}function c(e){let{image:t,onClick:a,onFavorite:s,onApprove:o,onReject:i,onClear:r,onPrint:c}=e,[d,u]=(0,l.useState)(null),m=e=>{u(e),setTimeout(()=>u(null),1500)},x=t.small||t.medium||t.thumb,h=t.full||t.large2x||t.medium2x||t.thumb2x;return(0,n.jsxs)("div",{className:"relative group cursor-pointer overflow-hidden rounded-lg bg-neutral-800 aspect-square shadow-md hover:shadow-lg transition",children:[(0,n.jsx)("img",{src:x,srcSet:"".concat(x," 1x, ").concat(h," 2x"),alt:t.title||"",loading:"lazy",className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onClick:a}),(0,n.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition",children:[(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),s(t),m("Marked as Favorite")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"❤️"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),o(t),m("Marked as Approved")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"✔️"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),i(t),m("Marked as Rejected")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"❌"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),c(t),m(t.print?"Print Removed":"Marked for Print")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"\uD83D\uDDA8️"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),r(t),m("Status Cleared")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"↺"})]}),(0,n.jsxs)("div",{className:"absolute bottom-2 left-2 space-y-1",children:["favorite"===t.state&&(0,n.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"❤️ Favorite"}),"approved"===t.state&&(0,n.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"✔️ Approved"}),"rejected"===t.state&&(0,n.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"❌ Rejected"}),t.print&&(0,n.jsx)("div",{className:"bg-yellow-600 text-xs px-2 py-1 rounded text-white",children:"\uD83D\uDDA8️ Print"})]}),d&&(0,n.jsx)("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 bg-white text-black px-3 py-1.5 rounded-md shadow text-xs font-medium animate-fade",children:d})]})}function d(e){let{image:t,onFavorite:a,onApprove:l,onReject:s,onClear:o,onPrint:i}=e;return(0,n.jsxs)("div",{className:"   absolute bottom-10 left-1/2 -translate-x-1/2    bg-black/60 backdrop-blur-sm    px-6 py-3 rounded-full flex gap-4 items-center   text-white shadow-lg   ",children:[(0,n.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>a(t.id),children:"❤️"}),(0,n.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>l(t.id),children:"✔️"}),(0,n.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>s(t.id),children:"❌"}),(0,n.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>i(t.id),children:"\uD83D\uDDA8️"}),(0,n.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>o(t.id),children:"↺"})]})}function u(e){let{image:t,onClose:a,onPrev:s,onNext:o,onFavorite:i,onApprove:r,onReject:c,onClear:u,onPrint:m}=e,[x,h]=(0,l.useState)(null),p=e=>{h(e),setTimeout(()=>h(null),1500)};return((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a(),"ArrowLeft"===e.key&&s(),"ArrowRight"===e.key&&o()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,s,o]),t)?(0,n.jsxs)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:[(0,n.jsx)("button",{className:"absolute top-5 right-5 text-white text-3xl",onClick:a,children:"✕"}),(0,n.jsx)("img",{src:t.full||t.large,alt:"",className:"max-w-full max-h-full rounded-lg shadow-xl"}),t.edited&&(0,n.jsx)("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 bg-emerald-700 text-white px-4 py-2 rounded shadow",children:"An edited version of this photo is available."}),x&&(0,n.jsx)("div",{className:"absolute bottom-32 left-1/2 -translate-x-1/2 bg-white text-black px-4 py-2 rounded-lg shadow text-sm font-medium animate-fade",children:x}),(0,n.jsx)(d,{image:t,onFavorite:e=>{i(e),p("Marked as Favorite")},onApprove:e=>{r(e),p("Marked as Approved")},onReject:e=>{c(e),p("Marked as Rejected")},onPrint:e=>{m(e),p("Marked for Print")},onClear:e=>{u(e),p("Status Cleared")}}),(0,n.jsx)("button",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-white text-4xl",onClick:s,children:"‹"}),(0,n.jsx)("button",{className:"absolute right-5 top-1/2 -translate-y-1/2 text-white text-4xl",onClick:o,children:"›"})]}):null}function m(e){let{albumId:t,sessionToken:a,sessionEmail:s,selectedImages:i,onSelectionChange:d}=e,[m,x]=(0,l.useState)([]),[h,p]=(0,l.useState)(!0),[b,g]=(0,l.useState)(null),[f,v]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async function(){var e;try{v(null);let e=await o("/albums/".concat(t,"/images?sessionToken=").concat(a));x(e),j(e)}catch(t){v(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Unable to load images")}finally{p(!1)}})()},[t,a]),(0,l.useEffect)(()=>{s&&localStorage.setItem("clientproofing:email",s)},[s]);let w=e=>{let t=e.storage_path||"",a=e.filename||"",n=(t=t.replace(/^\/+/,"")).endsWith(a)?t:"".concat(t,"/").concat(a);return"http://clients.chasing.media/dl.php?src=/storage/originals/".concat(n)},j=e=>{d(e.filter(e=>"favorite"===e.state||"approved"===e.state).map(e=>w(e)))},k=async(e,t)=>{let n=m.map(a=>a.id===e?{...a,state:t,print:"rejected"!==t&&a.print}:a);x(n),j(n),await r({sessionToken:a,imageId:e,state:t})},y=async e=>{let t=m.map(t=>t.id===e?{...t,state:null,print:!1}:t);x(t),j(t),await r({sessionToken:a,imageId:e,state:null,print:!1})},N=async e=>{let t=m.find(t=>t.id===e);t&&"rejected"!==t.state&&(x(m.map(t=>t.id===e?{...t,print:!t.print}:t)),await r({sessionToken:a,imageId:e,print:!t.print}))},C=e=>g(e);return h?(0,n.jsx)("div",{className:"text-neutral-400 w-full text-center py-10",children:"Loading..."}):f?(0,n.jsx)("div",{className:"text-red-400 w-full text-center py-10",children:f}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 p-2",children:m.map((e,t)=>(0,n.jsx)(c,{image:e,onClick:()=>C(t),onFavorite:()=>k(e.id,"favorite"),onApprove:()=>k(e.id,"approved"),onReject:()=>k(e.id,"rejected"),onClear:()=>y(e.id),onPrint:()=>N(e.id)},e.id))}),null!==b&&(0,n.jsx)(u,{image:m[b],onClose:()=>g(null),onPrev:()=>g(e=>e>0?e-1:m.length-1),onNext:()=>g(e=>e<m.length-1?e+1:0),onFavorite:e=>k(e,"favorite"),onApprove:e=>k(e,"approved"),onReject:e=>k(e,"rejected"),onClear:e=>y(e),onPrint:e=>N(e)})]})}var x=a(7635),h=a.n(x),p=a(12);let b={"1-1":1,"4-5":.8,"3-4":3/4,"9-16":9/16};async function g(e){let t=await fetch(e);return await t.blob()}async function f(e,t){return new Promise(a=>{let n=new Image;n.onload=()=>{let e,l;let s=n.width,o=n.height;s/o>t?(e=s,l=Math.round(s/t)):(l=o,e=Math.round(o*t));let i=function(e,t){let a=document.createElement("canvas");return a.width=e,a.height=t,a}(e,l),r=i.getContext("2d");r.filter="blur(80px)",r.drawImage(n,0,0,e,l),r.filter="none";let c=(e-s)/2,d=(l-o)/2;r.drawImage(n,c,d,s,o),i.toBlob(e=>a(e),"image/jpeg",.9)},n.src=URL.createObjectURL(e)})}async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"selected";if(!e.length)return;let a=new(h()),n=a.folder("original"),l=a.folder("processed/blurred");for(let t of e){let e=await g(t),a=t.split("/").pop()||"img-".concat(Date.now(),".jpg");for(let t of(n.file(a,e),Object.keys(b))){let n=await f(e,b[t]);l.folder(t).file(a.replace(/\.\w+$/,".jpg"),n)}}let s=await a.generateAsync({type:"blob"});(0,p.saveAs)(s,"instagram-".concat(t,"-").concat(Date.now(),".zip"))}function w(e){let{albumImages:t,selectedImages:a}=e,l=async()=>{await v(a,"selected")},s=async()=>{await v(t,"all")},o=async()=>{await v(a,"instagram")};return(0,n.jsxs)("div",{className:"flex gap-3 p-3 border-b bg-white",children:[(0,n.jsx)("button",{onClick:l,className:"px-3 py-1 bg-black text-white rounded",children:"Download Selected"}),(0,n.jsx)("button",{onClick:s,className:"px-3 py-1 bg-neutral-700 text-white rounded",children:"Download All"}),(0,n.jsx)("button",{onClick:o,className:"px-3 py-1 bg-[#E1306C] text-white rounded",children:"Download for Instagram"})]})}function j(e){var t;let{params:a}=e,s=Number(a.albumId),i=a.session,[r,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(null),[x,h]=(0,l.useState)(null),[p,b]=(0,l.useState)([]);return((0,l.useEffect)(()=>{(async function(){let e=await o("/client/session/".concat(i)),t=await o("/albums/".concat(s));u(e),c(t)})()},[s,i]),(0,l.useEffect)(()=>{var e;if(null==r?void 0:null===(e=r.images)||void 0===e?void 0:e.length){let e=Math.floor(Math.random()*r.images.length);h(r.images[e])}else h(null)},[r]),r&&d)?(0,n.jsxs)("div",{className:"p-6 text-neutral-300",children:[x&&(0,n.jsxs)("div",{className:"relative w-full h-60 mb-6 overflow-hidden",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-center bg-cover blur-2xl opacity-25",style:{backgroundImage:"url(".concat(x,")")}}),(0,n.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-neutral-900/50 via-neutral-900/30 to-transparent"})]}),(0,n.jsx)("h1",{className:"text-xl font-semibold mb-2",children:r.title}),(0,n.jsxs)("p",{className:"text-neutral-500 mb-6",children:["Viewing as: ",d.client_name]}),(0,n.jsx)(w,{albumImages:r.images,selectedImages:p}),(0,n.jsx)(m,{albumId:s,sessionToken:i,sessionEmail:null!==(t=d.email)&&void 0!==t?t:null,selectedImages:p,onSelectionChange:b})]}):(0,n.jsx)("div",{className:"p-6 text-neutral-400",children:"Loading album..."})}}},function(e){e.O(0,[609,573,971,117,744],function(){return e(e.s=5855)}),_N_E=e.O()}]);