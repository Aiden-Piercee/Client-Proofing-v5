(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{5855:function(e,t,n){Promise.resolve().then(n.bind(n,6654))},6654:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var a=n(7437),l=n(2265);let o="http://10.1.1.21:3700";async function s(e){let t=await fetch("".concat(o).concat(e),{cache:"no-store"});if(!t.ok)throw Error("GET ".concat(e," failed: ").concat(t.status));return t.json()}async function i(e,t){let n=await fetch("".concat(o).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),cache:"no-store"});if(!n.ok)throw Error("POST ".concat(e," failed: ").concat(n.status));return n.json()}function r(e){return i("/selections/".concat(e.sessionToken,"/").concat(e.imageId),{state:e.state,print:e.print})}let c=(0,l.forwardRef)((e,t)=>{let{image:n,selected:o,onClick:s,onOpen:i,onFavorite:r,onApprove:c,onReject:d,onClear:u,onPrint:h}=e,[p,x]=(0,l.useState)(null),m=e=>{x(e),setTimeout(()=>x(null),1500)},b=n.small||n.medium||n.thumb,g=n.full||n.large2x||n.medium2x||n.thumb2x;return(0,a.jsxs)("div",{ref:t,className:"relative group cursor-pointer overflow-hidden rounded-lg bg-neutral-800 aspect-square shadow-md hover:shadow-lg transition ".concat(o?"ring-2 ring-blue-400 ring-offset-2 ring-offset-neutral-900":""),onClick:s,onDoubleClick:e=>{e.stopPropagation(),i()},children:[(0,a.jsx)("img",{src:b,srcSet:"".concat(b," 1x, ").concat(g," 2x"),alt:n.title||"",loading:"lazy",className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}),o&&(0,a.jsx)("div",{className:"absolute inset-0 bg-blue-500/10","aria-hidden":!0,children:(0,a.jsx)("div",{className:"absolute top-2 left-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full shadow",children:"Selected"})}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),r(n),m("Marked as Favorite")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"❤️"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c(n),m("Marked as Approved")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"✔️"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),d(n),m("Marked as Rejected")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"❌"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),h(n),m(n.print?"Print Removed":"Marked for Print")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"\uD83D\uDDA8️"}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),u(n),m("Status Cleared")},className:"p-1 text-white/90 bg-black/40 hover:bg-black rounded",children:"↺"})]}),(0,a.jsxs)("div",{className:"absolute bottom-2 left-2 space-y-1",children:["favorite"===n.state&&(0,a.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"❤️ Favorite"}),"approved"===n.state&&(0,a.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"✔️ Approved"}),"rejected"===n.state&&(0,a.jsx)("div",{className:"bg-black/60 text-xs px-2 py-1 rounded text-white",children:"❌ Rejected"}),n.print&&(0,a.jsx)("div",{className:"bg-yellow-600 text-xs px-2 py-1 rounded text-white",children:"\uD83D\uDDA8️ Print"})]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"absolute bottom-2 right-2 bg-white/90 text-black text-xs px-2 py-1 rounded shadow hover:bg-white",children:"Open"}),p&&(0,a.jsx)("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 bg-white text-black px-3 py-1.5 rounded-md shadow text-xs font-medium animate-fade",children:p})]})});function d(e){let{image:t,onFavorite:n,onApprove:l,onReject:o,onClear:s,onPrint:i}=e;return(0,a.jsxs)("div",{className:"   absolute bottom-10 left-1/2 -translate-x-1/2    bg-black/60 backdrop-blur-sm    px-6 py-3 rounded-full flex gap-4 items-center   text-white shadow-lg   ",children:[(0,a.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>n(t.id),children:"❤️"}),(0,a.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>l(t.id),children:"✔️"}),(0,a.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>o(t.id),children:"❌"}),(0,a.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>i(t.id),children:"\uD83D\uDDA8️"}),(0,a.jsx)("button",{className:"text-2xl hover:scale-110",onClick:()=>s(t.id),children:"↺"})]})}function u(e){let{image:t,onClose:n,onPrev:o,onNext:s,onFavorite:i,onApprove:r,onReject:c,onClear:u,onPrint:h}=e,[p,x]=(0,l.useState)(null),m=e=>{x(e),setTimeout(()=>x(null),1500)};return((0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n(),"ArrowLeft"===e.key&&o(),"ArrowRight"===e.key&&s()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[n,o,s]),t)?(0,a.jsxs)("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50",children:[(0,a.jsx)("button",{className:"absolute top-5 right-5 text-white text-3xl",onClick:n,children:"✕"}),(0,a.jsx)("img",{src:t.full||t.large,alt:"",className:"max-w-full max-h-full rounded-lg shadow-xl"}),t.edited&&(0,a.jsx)("div",{className:"absolute bottom-24 left-1/2 -translate-x-1/2 bg-emerald-700 text-white px-4 py-2 rounded shadow",children:"An edited version of this photo is available."}),p&&(0,a.jsx)("div",{className:"absolute bottom-32 left-1/2 -translate-x-1/2 bg-white text-black px-4 py-2 rounded-lg shadow text-sm font-medium animate-fade",children:p}),(0,a.jsx)(d,{image:t,onFavorite:e=>{i(e),m("Marked as Favorite")},onApprove:e=>{r(e),m("Marked as Approved")},onReject:e=>{c(e),m("Marked as Rejected")},onPrint:e=>{h(e),m("Marked for Print")},onClear:e=>{u(e),m("Status Cleared")}}),(0,a.jsx)("button",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-white text-4xl",onClick:o,children:"‹"}),(0,a.jsx)("button",{className:"absolute right-5 top-1/2 -translate-y-1/2 text-white text-4xl",onClick:s,children:"›"})]}):null}function h(e){let{albumId:t,sessionToken:o,sessionEmail:i,selectedImages:d,onSelectionChange:h}=e,[p,x]=(0,l.useState)([]),[m,b]=(0,l.useState)(!0),[g,w]=(0,l.useState)(null),[v,f]=(0,l.useState)(null),[j,y]=(0,l.useState)(d),[k,N]=(0,l.useState)(null),[C,E]=(0,l.useState)(null),[S,A]=(0,l.useState)(null),[M,P]=(0,l.useState)(!1),[L,D]=(0,l.useState)(new Set),[R,I]=(0,l.useState)(!1),O=(0,l.useRef)([]),T=(0,l.useRef)(null);(0,l.useEffect)(()=>{(async function(){var e;try{f(null);let e=await s("/albums/".concat(t,"/images?sessionToken=").concat(o));x(e),_(e)}catch(t){f(null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Unable to load images")}finally{b(!1)}})()},[t,o]),(0,l.useEffect)(()=>{i&&localStorage.setItem("clientproofing:email",i)},[i]);let F=e=>{let t=e.storage_path||"",n=e.filename||"",a=(t=t.replace(/^\/+/,"")).endsWith(n)?t:"".concat(t,"/").concat(n);return"http://clients.chasing.media/dl.php?src=/storage/originals/".concat(a)};(0,l.useEffect)(()=>{y(d)},[d]);let _=e=>{let t=e.filter(e=>"favorite"===e.state||"approved"===e.state).map(e=>F(e));y(t),h(t)},z=(0,l.useCallback)(e=>{let t=Array.from(e);y(t),h(t)},[h]),Z=(0,l.useMemo)(()=>{let e=new Map;return p.forEach(t=>{e.set(F(t),t)}),e},[p]),B=async(e,t)=>{let n=p.map(n=>n.id===e?{...n,state:t,print:"rejected"!==t&&n.print}:n);x(n),_(n),await r({sessionToken:o,imageId:e,state:t})},U=async e=>{let t=p.map(t=>t.id===e?{...t,state:null,print:!1}:t);x(t),_(t),await r({sessionToken:o,imageId:e,state:null,print:!1})},q=async e=>{let t=p.find(t=>t.id===e);t&&"rejected"!==t.state&&(x(p.map(t=>t.id===e?{...t,print:!t.print}:t)),await r({sessionToken:o,imageId:e,print:!t.print}))},H=e=>w(e),X=(0,l.useCallback)((e,t)=>{let n=p[e];if(!n)return;let a=F(n),l=new Set(j);if(t&&null!==k){let t=Math.min(k,e),n=Math.max(k,e);for(let e=t;e<=n;e++){let t=F(p[e]);l.add(t)}}else l.has(a)?l.delete(a):l.add(a);N(e),z(l)},[p,j,k,z]),Y=(0,l.useCallback)(()=>{let e=new Set;p.forEach(t=>e.add(F(t))),z(e)},[p,z]),G=(0,l.useCallback)(()=>{z(new Set),N(null)},[z]),J=(0,l.useCallback)(async e=>{let t=Array.from(j).map(e=>Z.get(e)).filter(Boolean).map(e=>e.id);if(!t.length)return;let n=p.map(n=>t.includes(n.id)?{...n,state:e,print:"rejected"!==e&&n.print}:n);for(let a of(x(n),_(n),t))await r({sessionToken:o,imageId:a,state:e})},[p,o,j,Z]),K=(0,l.useCallback)(async()=>{let{downloadZip:e}=await Promise.resolve().then(n.bind(n,4674));await e(j,"selected")},[j]);(0,l.useEffect)(()=>{let e=()=>Y(),t=()=>G(),n=()=>J("approved"),a=()=>J("rejected"),l=()=>K();return window.addEventListener("selection:selectAll",e),window.addEventListener("selection:clearAll",t),window.addEventListener("selection:approve",n),window.addEventListener("selection:reject",a),window.addEventListener("selection:download",l),()=>{window.removeEventListener("selection:selectAll",e),window.removeEventListener("selection:clearAll",t),window.removeEventListener("selection:approve",n),window.removeEventListener("selection:reject",a),window.removeEventListener("selection:download",l)}},[Y,G,J,K]);let Q=(0,l.useCallback)(e=>{let t=new Set;O.current.forEach((n,a)=>{if(!n)return;let l=n.getBoundingClientRect();e.left<l.right&&e.right>l.left&&e.top<l.bottom&&e.bottom>l.top&&t.add(F(p[a]))}),D(t)},[p]),V=(0,l.useCallback)(e=>{if(!C)return;let t={x:e.clientX,y:e.clientY};A(t),T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(()=>{let e=C.x,n=C.y,a=t.x,l=t.y;Q(new DOMRect(Math.min(e,a),Math.min(n,l),Math.abs(e-a),Math.abs(n-l)))})},[C,Q]),W=(0,l.useCallback)(()=>{if(L.size){let e=new Set(j);L.forEach(t=>e.add(t)),z(e)}E(null),A(null),P(!1),D(new Set),T.current&&cancelAnimationFrame(T.current)},[z,L,j]),$=(0,l.useCallback)(()=>{M&&W(),window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",$)},[W,V,M]),ee=(0,l.useCallback)(e=>{if(0!==e.button||e.target instanceof HTMLElement&&e.target.closest("button"))return;P(!0);let t={x:e.clientX,y:e.clientY};E(t),A(t),Q(new DOMRect(t.x,t.y,0,0)),window.addEventListener("mousemove",V),window.addEventListener("mouseup",$)},[V,$,Q]),et=j.length>3&&!M;(0,l.useEffect)(()=>{let e=e=>{I(!!e.detail)};return window.addEventListener("selection:toolbar-visibility",e),()=>{window.removeEventListener("selection:toolbar-visibility",e)}},[]);let en=(0,l.useMemo)(()=>{if(!C||!S)return null;let e=Math.min(C.x,S.x);return{left:e,top:Math.min(C.y,S.y),width:Math.abs(C.x-S.x),height:Math.abs(C.y-S.y)}},[C,S]),ea=(0,l.useCallback)(e=>j.includes(e)||L.has(e),[j,L]);return m?(0,a.jsx)("div",{className:"text-neutral-400 w-full text-center py-10",children:"Loading..."}):v?(0,a.jsx)("div",{className:"text-red-400 w-full text-center py-10",children:v}):(0,a.jsxs)("div",{className:"relative",onMouseDown:ee,children:[(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 p-2",children:p.map((e,t)=>{let n=F(e);return(0,a.jsx)(c,{ref:e=>{O.current[t]=e},image:e,selected:ea(n),onClick:e=>{e.preventDefault(),X(t,e.shiftKey)},onOpen:()=>H(t),onFavorite:()=>B(e.id,"favorite"),onApprove:()=>B(e.id,"approved"),onReject:()=>B(e.id,"rejected"),onClear:()=>U(e.id),onPrint:()=>q(e.id)},e.id)})}),en&&(0,a.jsx)("div",{className:"absolute border border-blue-500/70 bg-blue-500/10 pointer-events-none",style:{left:en.left,top:en.top,width:en.width,height:en.height}}),et&&!R&&(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 bg-neutral-900 text-white shadow-lg rounded-full px-4 py-2 flex items-center gap-3 animate-fade-in",children:[(0,a.jsxs)("span",{className:"text-sm",children:[j.length," selected"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new Event("selection:selectAll"))},children:"Select All"}),(0,a.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-neutral-700 hover:bg-neutral-600",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new Event("selection:clearAll"))},children:"Clear"}),(0,a.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-green-600 hover:bg-green-500",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new Event("selection:approve"))},children:"Approve"}),(0,a.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-500",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new Event("selection:reject"))},children:"Reject"}),(0,a.jsx)("button",{className:"text-xs px-2 py-1 rounded bg-blue-600 hover:bg-blue-500",onClick:e=>{e.stopPropagation(),window.dispatchEvent(new Event("selection:download"))},children:"Download"})]})]}),null!==g&&(0,a.jsx)(u,{image:p[g],onClose:()=>w(null),onPrev:()=>w(e=>e>0?e-1:p.length-1),onNext:()=>w(e=>e<p.length-1?e+1:0),onFavorite:e=>B(e,"favorite"),onApprove:e=>B(e,"approved"),onReject:e=>B(e,"rejected"),onClear:e=>U(e),onPrint:e=>q(e)})]})}c.displayName="ImageCard";var p=n(4674);function x(e){let{albumImages:t,selectedImages:n,onSelectAll:o,onClearAll:s}=e,i=n.length>0,[r,c]=(0,l.useState)(!1),d=i&&!r,u=async()=>{await (0,p.downloadZip)(n,"selected")},h=async()=>{await (0,p.downloadZip)(t,"all")},x=async()=>{await (0,p.downloadZip)(n,"instagram")},m=(0,l.useMemo)(()=>"".concat(n.length," selected"),[n.length]),b=e=>{window.dispatchEvent(new Event(e))};return(0,l.useEffect)(()=>(window.dispatchEvent(new CustomEvent("selection:toolbar-visibility",{detail:d})),()=>{window.dispatchEvent(new CustomEvent("selection:toolbar-visibility",{detail:!1}))}),[d]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"pointer-events-none fixed left-1/2 bottom-4 z-30 flex w-full max-w-5xl -translate-x-1/2 justify-center transition-all duration-200 ".concat(d?"translate-y-0 opacity-100":"translate-y-24 opacity-0"),"aria-live":"polite",children:(0,a.jsxs)("div",{className:"pointer-events-auto flex flex-wrap items-center gap-3 rounded-2xl bg-white/95 px-4 py-3 shadow-lg ring-1 ring-neutral-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 text-sm font-medium text-neutral-700",children:[(0,a.jsx)("span",{children:m}),(0,a.jsx)("button",{onClick:()=>c(!0),className:"rounded-full bg-neutral-100 px-2 py-1 text-xs text-neutral-600 hover:bg-neutral-200",children:"Hide"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("button",{onClick:()=>{null==o||o(),b("selection:selectAll")},className:"px-3 py-1 rounded bg-neutral-800 text-white hover:bg-neutral-700 transition",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>{null==s||s(),b("selection:clearAll")},className:"px-3 py-1 rounded bg-neutral-100 text-neutral-800 hover:bg-neutral-200 transition",children:"Clear"}),(0,a.jsx)("button",{onClick:()=>b("selection:approve"),className:"px-3 py-1 rounded bg-green-600 text-white hover:bg-green-500 transition",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>b("selection:reject"),className:"px-3 py-1 rounded bg-red-600 text-white hover:bg-red-500 transition",children:"Reject"}),(0,a.jsx)("button",{onClick:u,className:"px-3 py-1 rounded bg-blue-700 text-white hover:bg-blue-600 transition",children:"Download Selected"}),(0,a.jsx)("button",{onClick:()=>b("selection:download"),className:"px-3 py-1 rounded bg-blue-100 text-blue-800 hover:bg-blue-200 transition",children:"Quick Download"}),(0,a.jsx)("button",{onClick:x,className:"px-3 py-1 bg-[#E1306C] text-white rounded hover:brightness-110 transition",children:"Instagram"}),(0,a.jsx)("button",{onClick:h,className:"px-3 py-1 bg-neutral-700 text-white rounded hover:bg-neutral-600 transition",children:"Download All"})]})]})}),r&&i&&(0,a.jsx)("button",{onClick:()=>c(!1),className:"fixed bottom-4 right-4 z-30 rounded-full bg-neutral-900 px-4 py-2 text-white shadow-lg hover:bg-neutral-800",children:"Show Toolbar"})]})}function m(e){var t;let{params:n}=e,o=Number(n.albumId),i=n.session,[r,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(null),[p,m]=(0,l.useState)(null),[b,g]=(0,l.useState)([]);return((0,l.useEffect)(()=>{(async function(){let e=await s("/client/session/".concat(i)),t=await s("/albums/".concat(o));u(e),c(t)})()},[o,i]),(0,l.useEffect)(()=>{var e;if(null==r?void 0:null===(e=r.images)||void 0===e?void 0:e.length){let e=Math.floor(Math.random()*r.images.length);m(r.images[e])}else m(null)},[r]),r&&d)?(0,a.jsxs)("div",{className:"p-6 text-neutral-300",children:[p&&(0,a.jsxs)("div",{className:"relative w-full h-60 mb-6 overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-center bg-cover blur-2xl opacity-25",style:{backgroundImage:"url(".concat(p,")")}}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-neutral-900/50 via-neutral-900/30 to-transparent"})]}),(0,a.jsx)("h1",{className:"text-xl font-semibold mb-2",children:r.title}),(0,a.jsxs)("p",{className:"text-neutral-500 mb-6",children:["Viewing as: ",d.client_name]}),(0,a.jsx)(x,{albumImages:r.images,selectedImages:b}),(0,a.jsx)(h,{albumId:o,sessionToken:i,sessionEmail:null!==(t=d.email)&&void 0!==t?t:null,selectedImages:b,onSelectionChange:g})]}):(0,a.jsx)("div",{className:"p-6 text-neutral-400",children:"Loading album..."})}},4674:function(e,t,n){"use strict";n.d(t,{downloadZip:function(){return c}});var a=n(7635),l=n.n(a),o=n(12);let s={"1-1":1,"4-5":.8,"3-4":3/4,"9-16":9/16};async function i(e){let t=await fetch(e);return await t.blob()}async function r(e,t){return new Promise(n=>{let a=new Image;a.onload=()=>{let e,l;let o=a.width,s=a.height;o/s>t?(e=o,l=Math.round(o/t)):(l=s,e=Math.round(s*t));let i=function(e,t){let n=document.createElement("canvas");return n.width=e,n.height=t,n}(e,l),r=i.getContext("2d");r.filter="blur(80px)",r.drawImage(a,0,0,e,l),r.filter="none";let c=(e-o)/2,d=(l-s)/2;r.drawImage(a,c,d,o,s),i.toBlob(e=>n(e),"image/jpeg",.9)},a.src=URL.createObjectURL(e)})}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"selected";if(!e.length)return;let n=new(l()),a=n.folder("original"),c=n.folder("processed/blurred");for(let t of e){let e=await i(t),n=t.split("/").pop()||"img-".concat(Date.now(),".jpg");for(let t of(a.file(n,e),Object.keys(s))){let a=await r(e,s[t]);c.folder(t).file(n.replace(/\.\w+$/,".jpg"),a)}}let d=await n.generateAsync({type:"blob"});(0,o.saveAs)(d,"instagram-".concat(t,"-").concat(Date.now(),".zip"))}}},function(e){e.O(0,[609,573,971,117,744],function(){return e(e.s=5855)}),_N_E=e.O()}]);